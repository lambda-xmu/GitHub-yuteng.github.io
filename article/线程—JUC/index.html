<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          java.util.concurrent - äºè…¾ | Blog
        
    </title>

    <link rel="canonical" href="https://github-yuteng.github.io/article/çº¿ç¨‹â€”JUC/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#çº¿ç¨‹" title="çº¿ç¨‹">çº¿ç¨‹</a>
                            
                        </div>
                        <h1>java.util.concurrent</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by äºè…¾ on
                            2019-05-02
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">æ‰€çˆ±éš”å±±æµ·</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">å…³äºæˆ‘</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="ä¸€-è¿›ç¨‹å’Œçº¿ç¨‹">ä¸€ã€è¿›ç¨‹å’Œçº¿ç¨‹</h2>
<p><strong>æ ¹æœ¬åŒºåˆ«ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯ CPU ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½</strong>ã€‚</p>
<ul>
<li><strong>ä¸€ä¸ªç¨‹åº(è¿›ç¨‹)åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡ç§°ä¸ºä¸€ä¸ªçº¿ç¨‹ã€‚</strong></li>
<li><strong>è¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ï¼Œä¸å­˜åœ¨æ²¡æœ‰çº¿ç¨‹çš„è¿›ç¨‹çš„ã€‚</strong></li>
</ul>
<p><strong>åœ¨å¼€é”€æ–¹é¢ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼ˆç¨‹åºä¸Šä¸‹æ–‡ï¼‰ï¼Œç¨‹åºä¹‹é—´çš„åˆ‡æ¢ä¼šæœ‰è¾ƒå¤§çš„å¼€é”€ï¼›</li>
<li>çº¿ç¨‹å¯ä»¥çœ‹åšè½»é‡çº§çš„è¿›ç¨‹ï¼ŒåŒä¸€ç±»çº¿ç¨‹å…±äº«ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„å¼€é”€å°ã€‚</li>
</ul>
<p><strong>æ‰€å¤„ç¯å¢ƒï¼š</strong></p>
<ul>
<li>åœ¨æ“ä½œç³»ç»Ÿä¸­èƒ½åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰ï¼›</li>
<li>è€Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆé€šè¿‡CPUè°ƒåº¦ï¼Œåœ¨æ¯ä¸ªæ—¶é—´ç‰‡ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰</li>
</ul>
<p><strong>å†…å­˜åˆ†é…æ–¹é¢ï¼š</strong></p>
<ul>
<li><strong>è¿›ç¨‹ï¼š</strong> ç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜ç©ºé—´ï¼›</li>
<li><strong>çº¿ç¨‹ï¼š</strong> é™¤äº†CPUå¤–ï¼Œç³»ç»Ÿä¸ä¼šä¸ºçº¿ç¨‹åˆ†é…å†…å­˜ï¼ˆçº¿ç¨‹æ‰€ä½¿ç”¨çš„èµ„æºæ¥è‡ªå…¶æ‰€å±è¿›ç¨‹çš„èµ„æºï¼‰ï¼Œçº¿ç¨‹ç»„ä¹‹é—´åªèƒ½å…±äº«èµ„æºã€‚</li>
</ul>
<h3 id="11-å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹åŒºåˆ«">1.1ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹åŒºåˆ«</h3>
<ul>
<li>æœ¬è´¨åŒºåˆ«åœ¨äºæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„ä¸€å¥—å˜é‡ï¼Œè€Œçº¿ç¨‹åˆ™å…±äº«æ•°æ®ã€‚</li>
<li>å…±äº«å˜é‡ä½¿çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ¯”è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ›´æœ‰æ•ˆï¼Œæ›´å®¹æ˜“ã€‚</li>
<li>çº¿ç¨‹æ›´åŠ â€œè½»é‡çº§â€ï¼Œåˆ›å»ºã€æ’¤é”€ä¸€ä¸ªçº¿ç¨‹æ¯”å¯åŠ¨æ–°è¿›ç¨‹çš„å¼€é”€å°å¾—å¤šã€‚</li>
</ul>
<hr>
<h3 id="12-å®ˆæŠ¤çº¿ç¨‹ä¸éå®ˆæŠ¤çº¿ç¨‹">1.2ã€å®ˆæŠ¤çº¿ç¨‹ä¸éå®ˆæŠ¤çº¿ç¨‹</h3>
<ul>
<li>
<p><strong>ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œjvmä¼šç­‰å¾…éå®ˆæŠ¤çº¿ç¨‹å®Œæˆåå…³é—­ï¼Œä½†æ˜¯jvmä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹ã€‚</strong></p>
</li>
<li>
<p><strong>å®ˆæŠ¤çº¿ç¨‹æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯GCçº¿ç¨‹ã€‚</strong></p>
</li>
</ul>
<h4 id="å®ˆæŠ¤çº¿ç¨‹">å®ˆæŠ¤çº¿ç¨‹</h4>
<ul>
<li><strong>åƒåœ¾å›æ”¶çº¿ç¨‹ï¼šGCçº¿ç¨‹</strong></li>
<li><strong>å½“ä¸»çº¿ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹ä¸€èµ·è¿è¡Œã€‚å½“ä¸»çº¿ç¨‹é”€æ¯ï¼Œä¼šå’Œä¸»çº¿ç¨‹ä¸€èµ·é”€æ¯ã€‚</strong></li>
</ul>
<h4 id="éå®ˆæŠ¤çº¿ç¨‹ç”¨æˆ·çº¿ç¨‹">éå®ˆæŠ¤çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</h4>
<ul>
<li><strong>éå®ˆæŠ¤çº¿ç¨‹å³æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„çº¿ç¨‹</strong>ã€‚</li>
<li><strong>å¦‚æœä¸»çº¿ç¨‹é”€æ¯ï¼Œç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œä¸”äº’ä¸å½±å“ã€‚</strong></li>
</ul>
<h4 id="åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹">åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ ğŸ‘‡</h4>
<ul>
<li><strong>å¿…é¡»åœ¨ <code>t1.start()</code>ä¹‹å‰è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ <code>t1.setDaemon(true);</code></strong></li>
<li><strong>ä¸èƒ½æŠŠæ­£åœ¨è¿è¡Œçš„å¸¸è§„çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹,å¦åˆ™æŠ¥IllegalThreadStateExceptionå¼‚å¸¸ã€‚</strong></li>
<li><strong>ä¸»çº¿ç¨‹ç»“æŸä¹‹åå¹¶æ²¡æœ‰åœ¨ç»§ç»­è¿è¡Œå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿè·Ÿç€ç»“æŸï¼Œä¸€èµ·é”€æ¯åœæ­¢ã€‚</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">/*Thread t1 = new Thread(new Runnable() &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void run() &#123;</span></span><br><span class="line"><span class="comment">                while (true) &#123;</span></span><br><span class="line"><span class="comment">                    try &#123;</span></span><br><span class="line"><span class="comment">                        Thread.sleep(1000);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">                        e.printStackTrace();</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                    System.out.println("æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)");</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO æ ‡è¯†å½“å‰æ–¹æ³•ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸€å®šè¦åœ¨å¯åŠ¨çº¿ç¨‹å‰è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">        t1.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç›¸å½“ä¸ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"main:i:"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">main:i:<span class="number">0</span></span><br><span class="line">main:i:<span class="number">1</span></span><br><span class="line">main:i:<span class="number">2</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">3</span></span><br><span class="line">main:i:<span class="number">4</span></span><br><span class="line">main:i:<span class="number">5</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">6</span></span><br><span class="line">main:i:<span class="number">7</span></span><br><span class="line">main:i:<span class="number">8</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">9</span></span><br><span class="line">ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºéå®ˆæŠ¤çº¿ç¨‹">åˆ›å»ºéå®ˆæŠ¤çº¿ç¨‹ï¼šğŸ‘‡</h4>
<ul>
<li>
<p><strong>å¦‚æœä¸»çº¿ç¨‹é”€æ¯ï¼Œç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œä¸”äº’ä¸å½±å“ã€‚</strong></p>
</li>
<li>
<p><strong>å½“ä¸»çº¿ç¨‹é”€æ¯åœæ­¢ï¼Œéå®ˆæŠ¤çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰å¹¶æ²¡æœ‰ç»“æŸï¼Œè€Œæ˜¯ä¸€ç›´åœ¨æ‰§è¡Œï¼Œä¸ä¸»çº¿ç¨‹äº’ä¸å½±å“ã€‚</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotDaemonThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">/* Thread t1 = new Thread(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void run() &#123;</span></span><br><span class="line"><span class="comment">                while (true) &#123;</span></span><br><span class="line"><span class="comment">                    try &#123;</span></span><br><span class="line"><span class="comment">                        Thread.sleep(1000);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">                        e.printStackTrace();</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                    System.out.println("æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)");</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// TODO å¯åŠ¨çº¿ç¨‹ æ²¡æœ‰å¼€å¯å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç›¸å½“ä¸ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"main:i:"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">main:i:<span class="number">0</span></span><br><span class="line">main:i:<span class="number">1</span></span><br><span class="line">main:i:<span class="number">2</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">3</span></span><br><span class="line">main:i:<span class="number">4</span></span><br><span class="line">main:i:<span class="number">5</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">6</span></span><br><span class="line">main:i:<span class="number">7</span></span><br><span class="line">main:i:<span class="number">8</span></span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">main:i:<span class="number">9</span></span><br><span class="line">ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...</span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">æˆ‘æ˜¯å­çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="äºŒ-volatile">äºŒã€volatile</h2>
<p><strong>volatile å…³é”®å­—ï¼š</strong></p>
<ul>
<li><strong>æ˜¯Javaè™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œå…±äº«æ•°æ®æ—¶ï¼Œå¯ä»¥ä¿è¯å†…å­˜ä¸­çš„æ•°æ®å¯è§ã€‚æä¾›ä¸€ä¸ªå…é”æœºåˆ¶ï¼Œç›¸è¾ƒäº synchronized æ˜¯ä¸€ç§è¾ƒä¸ºè½»é‡çº§çš„åŒæ­¥ç­–ç•¥ã€‚</strong></li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>
<p><strong>volatile ä¿è¯å†…å­˜å¯è§æ€§</strong>ï¼›</p>
</li>
<li>
<p><strong>volatile ä¸èƒ½ä¿è¯å˜é‡çš„â€œåŸå­æ€§â€ï¼›</strong> ä¸å¯åˆ†å‰²ï¼Œå®Œæ•´æ€§ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å¯ä»¥è¢«åŠ å¡ã€‚</p>
</li>
<li>
<p><strong>volatile ä¸å…·å¤‡â€œäº’æ–¥æ€§â€ï¼›</strong>(äº’æ–¥æ€§ï¼Œå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå¦å¤–çº¿ç¨‹åˆ™å¿…é¡»ç­‰å¾…)</p>
</li>
<li>
<p><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</strong></p>
</li>
</ul>
<img src="https://i.loli.net/2019/07/19/5d3132852c9c330873.png" alt="1.png" title="1.png">
<h3 id="21-æµ‹è¯•-volatile-å†…å­˜å¯è§æ€§">2.1ã€æµ‹è¯• volatile å†…å­˜å¯è§æ€§</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestVolatile</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ThreadDemo td = <span class="keyword">new</span> ThreadDemo();</span><br><span class="line">		<span class="keyword">new</span> Thread(td).start();</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (td.isFlag()) &#123;</span><br><span class="line">				System.out.println(<span class="string">"End"</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="comment">// voatile æ¯”é”æ•ˆç‡è¦é«˜</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">200</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		flag = <span class="keyword">true</span>;</span><br><span class="line">		System.out.println(<span class="string">"flag="</span> + isFlag());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> flag;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.flag = flag;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">flag=<span class="keyword">true</span></span><br><span class="line">End</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="22-æµ‹è¯•-volatile-åŸå­æ€§">2.2ã€æµ‹è¯• volatile åŸå­æ€§</h3>
<p><strong>i++ çš„åŸå­æ€§é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>i++ çš„æ“ä½œå®é™…ä¸Šåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤â€œè¯»-æ”¹-å†™â€œ å­—èŠ‚ç å¦‚ä¸‹ï¼š</strong>
<ul>
<li><strong>aload_0</strong></li>
<li><strong>dup</strong></li>
<li><strong>getfield</strong></li>
<li><strong>iconst_1</strong></li>
<li><strong>iadd</strong></li>
<li><strong>putfield</strong></li>
</ul>
</li>
</ul>
<p><strong>åœ¨ä¸­é—´æŸä¸€æ­¥å¦‚æœCPUåˆ‡æ¢è°ƒåº¦ï¼Œåˆ™æ— æ³•ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ã€‚</strong></p>
<p><strong>åŸå­å˜é‡ï¼šåœ¨ java.util.concurrent.atomic åŒ…ä¸‹æä¾›äº†ä¸€äº›åŸå­å˜é‡ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">numTo60</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = <span class="number">60</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPulsPuls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MyAtomicInteger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        atomicInteger.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        VolatileKeyWord();</span><br><span class="line">        System.out.println(<span class="string">"-----------"</span>);</span><br><span class="line">        AtomicIntegerDemo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AtomicIntegerDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MyData myData = <span class="keyword">new</span> MyData();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    myData.addPulsPuls();</span><br><span class="line">                    myData.MyAtomicInteger();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å½“ä¸Šé¢ 20ä¸ªçº¿ç¨‹è¿è¡Œå®Œæ¯•åï¼Œç”¨ Mainçº¿ç¨‹çœ‹æœ€åç»“æœæ˜¯å¤šå°‘</span></span><br><span class="line">        <span class="comment">// main &amp; GC</span></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" Finally num :"</span> + myData.num);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" Finally num :"</span> + myData.atomicInteger);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * volatile int num = 0;</span></span><br><span class="line"><span class="comment">     * 1ã€è¯æ˜ Volatile å†…å­˜å¯è§æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">VolatileKeyWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyData myData = <span class="keyword">new</span> MyData();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" Enter"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            myData.numTo60();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" Updata num"</span> + myData.num);</span><br><span class="line">        &#125;, <span class="string">"Thread-Son"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (myData.num == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"End:"</span> + myData.num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="23-cas">2.3ã€CAS</h3>
<img src="https://i.loli.net/2019/07/19/5d31582d1577279493.png" alt="B`4}R)9N%M5$KV]$7RPQ$_M.png" title="B`4}R)9N%M5$KV]$7RPQ$_M.png">
<ul>
<li><strong>CASï¼ˆCompare-And-Swapï¼‰ ç®—æ³•ä¿è¯æ•°æ®å˜é‡çš„åŸå­æ€§</strong>ã€‚</li>
<li><strong>CAS ç®—æ³•æ˜¯ç¡¬ä»¶å¯¹äºå¹¶å‘æ“ä½œçš„æ”¯æŒ  æ•ˆç‡æ¯”åŒæ­¥é”é«˜</strong> ã€‚</li>
<li><strong>CAS åŒ…å«äº†ä¸‰ä¸ªæ“ä½œæ•°ï¼š</strong>
<ul>
<li><strong>â‘ å†…å­˜å€¼  V</strong></li>
<li><strong>â‘¡é¢„ä¼°å€¼  A</strong></li>
<li><strong>â‘¢æ›´æ–°å€¼  B</strong></li>
<li><strong>å½“ä¸”ä»…å½“ V == A æ—¶ï¼Œâ€”&gt; V = B;  B èµ‹å€¼ç»™ V å¦åˆ™ï¼Œä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚</strong></li>
</ul>
</li>
<li><strong>å®ƒçš„åŠŸèƒ½æ˜¯åˆ¤æ–­å†…å­˜æŸä¸ªä½ç½®çš„å€¼æ˜¯å¦ä¸ºé¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ”¹ä¸ºæ–°å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŸå­çš„ã€‚</strong></li>
</ul>
<p><strong>CAS</strong> å¹¶å‘åŸè¯­ä½“ç°åœ¨ JAVA è¯­è¨€ä¸­å°±æ˜¯ sun.misc.Unsafe ç±»ä¸­çš„å„ä¸ªæ–¹æ³•ã€‚è°ƒç”¨ UnSafe ç±»ä¸­çš„CASæ–¹æ³•ï¼ŒJVM ä¼šå¸®æˆ‘ä»¬å®ç°å‡ºCASæ±‡ç¼–æŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ç§å®Œå…¨ä¾èµ–äºç¡¬ä»¶çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ƒå®ç°äº†åŸå­æ“ä½œã€‚ç”±äºCASæ˜¯ä¸€ ç§ç³»ç»ŸåŸè¯­ï¼ŒåŸè¯­å±äºæ“ä½œç³»ç»Ÿç”¨è¯­èŒƒç•´ï¼Œæ˜¯ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆçš„ï¼Œç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œ<strong>å¹¶ä¸”åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´CASæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜</strong>ã€‚</p>
<hr>
<h4 id="unsafe-ç±»">Unsafe ç±»</h4>
<p>Unsafe æ˜¯ CAS çš„æ ¸å¿ƒç±»ï¼Œç”±äºJavaæ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°(native) æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚Unsafe ç±»å­˜åœ¨äº <code>rt.jar sun.misc</code> åŒ…ä¸­ï¼Œå…¶å†…éƒ¨æ–¹æ³•æ“ä½œå¯ä»¥åƒCçš„æŒ‡é’ˆä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜ï¼Œå› ä¸ºJavaä¸­ CAS æ“ä½œçš„æ‰§è¡Œä¾èµ–äº Unsafe ç±»çš„æ–¹æ³•ã€‚</p>
<ul>
<li><strong>æ³¨ï¼šUnsafeç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯nativeä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Unsafeç±»ä¸­çš„æ–¹æ³•éƒ½ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚èµ„æºæ‰§è¡Œç›¸åº”ä»»åŠ¡</strong></li>
</ul>
<hr>
<h4 id="cas-çš„ç¼ºç‚¹">CAS çš„ç¼ºç‚¹</h4>
<ul>
<li>å¾ªç¯æ—¶é—´é•¿ï¼Œå¼€é”€å¤§ã€‚å¦‚æœCASå¤±è´¥ï¼Œä¼šä¸€ç›´è¿›è¡Œå°è¯•ã€‚å¦‚æœCASé•¿æ—¶é—´ä¸€ç›´ä¸æˆåŠŸï¼Œå¯èƒ½ä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚</li>
<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼›å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é”æ¥ä¿è¯åŸå­æ€§ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">* this å½“å‰å¯¹è±¡</span></span><br><span class="line"><span class="comment">* valueOffset å†…å­˜åç§»é‡ï¼Œå†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var1 AtomicIntegerå¯¹è±¡æœ¬èº«</span></span><br><span class="line"><span class="comment">// var2 è¯¥å¯¹è±¡å€¼çš„å¼•ç”¨åœ°å€</span></span><br><span class="line"><span class="comment">// var4 éœ€è¦å˜åŠ¨çš„å€¼ -&gt; 1</span></span><br><span class="line"><span class="comment">// var5 é€šè¿‡var1ã€var2æ‰¾å‡ºä¸»å†…å­˜ä¸­çœŸå®çš„å€¼</span></span><br><span class="line"><span class="comment">// ç”¨è¯¥å¯¹è±¡å½“å‰çš„å€¼ä¸var5æ¯”è¾ƒï¼š</span></span><br><span class="line"><span class="comment">// ç›¸åŒï¼Œæ›´æ–°var5+var4å¹¶è¿”å›true</span></span><br><span class="line"><span class="comment">// ä¸åŒï¼Œç»§ç»­å–å€¼ç„¶åå†æ¯”è¾ƒ,ç›´åˆ°æ›´æ–°å®Œæˆ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndAddInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> var5;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        var5 = <span class="keyword">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">    &#125; <span class="keyword">while</span>(!<span class="keyword">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="aba-é—®é¢˜">ABA é—®é¢˜ ğŸ‘‡</h4>
<p>CASç®—æ³•å®ç°ä¸€ä¸ªé‡è¦å‰æéœ€è¦å–å‡ºå†…å­˜ä¸­æŸæ—¶åˆ»çš„æ•°æ®å¹¶åœ¨å½“ä¸‹æ—¶åˆ»æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶é—´å·®ç±»ä¼šå¯¼è‡´æ•°æ®çš„å˜åŒ–ã€‚</p>
<ul>
<li>æ¯”å¦‚è¯´ä¸€ä¸ªçº¿ç¨‹oneä»å†…å­˜ä½ç½®Vä¸­å–å‡ºAï¼Œè¿™æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹twoä¹Ÿä»å†…å­˜ä¸­å–å‡ºAï¼Œå¹¶ä¸”çº¿ç¨‹twoè¿›è¡Œäº†ä¸€äº›æ“ä½œå°†å€¼å˜æˆäº†B,:ç„¶åçº¿ç¨‹twoåˆå°†Vä½ç½®çš„æ•°æ®å˜æˆAï¼Œè¿™æ—¶å€™çº¿ç¨‹oneè¿›è¡ŒCASæ“ä½œå‘ç°å†…å­˜ä¸­ä»ç„¶æ˜¯Aï¼Œç„¶åçº¿ç¨‹oneæ“ä½œæˆåŠŸã€‚<strong>å°½ç®¡çº¿ç¨‹oneçš„CASæ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸ä»£è¡¨è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CASDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> AtomicReference&lt;Integer&gt; atomicReference = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">101</span>);</span><br><span class="line">            atomicReference.compareAndSet(<span class="number">101</span>, <span class="number">100</span>);</span><br><span class="line">        &#125;, <span class="string">"t1"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æš‚åœ1ç§’é’Ÿt2çº¿ç¨‹ï¼Œä¿è¯ä¸Šé¢çš„t1çº¿ç¨‹å®Œæˆäº†ä¸€æ¬¡ABAæ“ä½œ</span></span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"-&gt;"</span> + atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">200</span>) + <span class="string">"\t"</span> + atomicReference.get());</span><br><span class="line">        &#125;, <span class="string">"t2"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">è¾“å‡º <span class="keyword">true</span>	<span class="number">200</span></span><br></pre></td></tr></table></figure>
<h4 id="è§£å†³-aba-åŸå­å¼•ç”¨">è§£å†³ ABA åŸå­å¼•ç”¨</h4>
<ul>
<li><strong>AtomicStampedReference</strong></li>
<li><strong>AtomicReference</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CASTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> AtomicStampedReference&lt;Integer&gt; atomicStampedReference = <span class="keyword">new</span> AtomicStampedReference&lt;&gt;(<span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"------ABAé—®é¢˜çš„è§£å†³--------"</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// åˆå§‹ç‰ˆæœ¬å·</span></span><br><span class="line">            <span class="keyword">int</span> stamp = atomicStampedReference.getStamp();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tç¬¬ä¸€æ¬¡ç‰ˆæœ¬å·"</span> + stamp);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æš‚åœ1ç§’é’Ÿt3çº¿ç¨‹</span></span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            atomicStampedReference.compareAndSet(<span class="number">100</span>, <span class="number">101</span>, atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + <span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tç¬¬äºŒæ¬¡ç‰ˆæœ¬å·"</span> + atomicStampedReference.getStamp());</span><br><span class="line">            atomicStampedReference.compareAndSet(<span class="number">101</span>, <span class="number">100</span>, atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + <span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tç¬¬ä¸‰æ¬¡ç‰ˆæœ¬å·"</span> + atomicStampedReference.getStamp());</span><br><span class="line">        &#125;, <span class="string">"t3"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> stamp = atomicStampedReference.getStamp();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tç¬¬ä¸€æ¬¡ç‰ˆæœ¬å·"</span> + stamp);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æš‚åœ3ç§’é’Ÿt4çº¿ç¨‹ï¼Œä¿è¯ä¸Šé¢çš„t3çº¿ç¨‹å®Œæˆäº†ä¸€æ¬¡ABAæ“ä½œ</span></span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">boolean</span> result = atomicStampedReference.compareAndSet(<span class="number">100</span>, <span class="number">200</span>, stamp, stamp + <span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tä¿®æ”¹æˆåŠŸå¦ï¼š"</span> + result + <span class="string">"\tå½“å‰æœ€æ–°å®é™…ç‰ˆæœ¬å·:"</span> + atomicStampedReference.getStamp());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\tå½“å‰å®é™…æœ€æ–°å€¼ï¼š"</span> + atomicStampedReference.getReference());</span><br><span class="line">        &#125;, <span class="string">"t4"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">------ABAé—®é¢˜çš„è§£å†³--------</span><br><span class="line">t3	ç¬¬ä¸€æ¬¡ç‰ˆæœ¬å·<span class="number">1</span></span><br><span class="line">t4	ç¬¬ä¸€æ¬¡ç‰ˆæœ¬å·<span class="number">1</span></span><br><span class="line">t3	ç¬¬äºŒæ¬¡ç‰ˆæœ¬å·<span class="number">2</span></span><br><span class="line">t3	ç¬¬ä¸‰æ¬¡ç‰ˆæœ¬å·<span class="number">3</span></span><br><span class="line">t4	ä¿®æ”¹æˆåŠŸå¦ï¼š<span class="keyword">false</span>	å½“å‰æœ€æ–°å®é™…ç‰ˆæœ¬å·:<span class="number">3</span></span><br><span class="line">t4	å½“å‰å®é™…æœ€æ–°å€¼ï¼š<span class="number">100</span></span><br></pre></td></tr></table></figure>
<h4 id="æ¨¡æ‹Ÿ-cas-ç®—æ³•">æ¨¡æ‹Ÿ CAS ç®—æ³•</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCompareAndSwap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> CompareAndSwap cas = <span class="keyword">new</span> CompareAndSwap();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">				</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">					<span class="keyword">int</span> expectedValue = cas.get();</span><br><span class="line">					<span class="keyword">boolean</span> b = cas.compareAndSet(expectedValue, (<span class="keyword">int</span>)(Math.random() * <span class="number">101</span>));</span><br><span class="line">					System.out.println(b);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompareAndSwap</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">	<span class="comment">//è·å–å†…å­˜å€¼</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//æ¯”è¾ƒ</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">compareAndSwap</span><span class="params">(<span class="keyword">int</span> expectedValue, <span class="keyword">int</span> newValue)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> oldValue = value;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(oldValue == expectedValue)&#123;</span><br><span class="line">			<span class="keyword">this</span>.value = newValue;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> oldValue;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è®¾ç½®</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expectedValue, <span class="keyword">int</span> newValue)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> expectedValue == compareAndSwap(expectedValue, newValue);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="ä¸ºä»€ä¹ˆç”¨-cas-ä¸ç”¨-synchronized">ä¸ºä»€ä¹ˆç”¨ CAS ä¸ç”¨ Synchronized</h4>
<p>åœ¨Javaå¹¶å‘ä¸­ï¼Œæˆ‘ä»¬æœ€åˆæ¥è§¦çš„åº”è¯¥å°±æ˜¯<code>synchronized</code>å…³é”®å­—äº†ï¼Œä½†æ˜¯<code>synchronized</code>å±äºé‡é‡çº§é”ï¼Œå¾ˆå¤šæ—¶å€™ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ï¼Œvolatileä¹Ÿæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯volatileä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œåªèƒ½åœ¨æŸäº›åœºåˆä¸‹ä½¿ç”¨ã€‚åƒ<code>synchronized</code>è¿™ç§ç‹¬å é”å±äº<strong>æ‚²è§‚é”</strong>ï¼Œå®ƒæ˜¯åœ¨å‡è®¾ä¸€å®šä¼šå‘ç”Ÿå†²çªçš„ï¼Œé‚£ä¹ˆåŠ é”æ°å¥½æœ‰ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰<strong>ä¹è§‚é”</strong>ï¼Œä¹è§‚é”çš„å«ä¹‰å°±æ˜¯å‡è®¾æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆæˆ‘æ­£å¥½å¯ä»¥è¿›è¡ŒæŸé¡¹æ“ä½œï¼Œå¦‚æœè¦æ˜¯å‘ç”Ÿå†²çªå‘¢ï¼Œé‚£æˆ‘å°±é‡è¯•ç›´åˆ°æˆåŠŸï¼Œä¹è§‚é”æœ€å¸¸è§çš„å°±æ˜¯<code>CAS</code>ã€‚</p>
<hr>
<h3 id="24-ç¦æ­¢æŒ‡ä»¤é‡æ’">2.4ã€ç¦æ­¢æŒ‡ä»¤é‡æ’</h3>
<p><strong>æŒ‡ä»¤é‡æ’åº :</strong> å¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p>
<p><strong>JVMåº•å±‚ä¼˜åŒ–ï¼ŒæŒ‡ä»¤é‡æ’åº(ä¹±åºæ‰§è¡Œï¼Œå¢åŠ æ•ˆç‡)ï¼Œä½¿ç”¨volatileä¿®é¥°åå°±ä¸èƒ½é‡æ’åºäº†ã€‚</strong></p>
<ul>
<li><strong>æœ‰volatileä¿®é¥°çš„å˜é‡ï¼Œèµ‹å€¼åå¤šæ‰§è¡Œäº†ä¸€ä¸ªâ€œload addl $0x0, (%esp)â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆæŒ‡ä»¤é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªCPUè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼›ï¼ˆä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼šæ˜¯æŒ‡CPUé‡‡ç”¨äº†å…è®¸å°†å¤šæ¡æŒ‡ä»¤ä¸æŒ‰ç¨‹åºè§„å®šçš„é¡ºåºåˆ†å¼€å‘é€ç»™å„ç›¸åº”ç”µè·¯å•å…ƒå¤„ç†ï¼‰ã€‚</strong></li>
</ul>
<hr>
<h3 id="25-volatile-ä½¿ç”¨åœºæ™¯">2.5ã€volatile ä½¿ç”¨åœºæ™¯</h3>
<h4 id="å•ä¾‹è®¾è®¡æ¨¡å¼-dclåŒæ£€æŸ¥é”æœºåˆ¶">å•ä¾‹è®¾è®¡æ¨¡å¼ DCLåŒæ£€æŸ¥é”æœºåˆ¶</h4>
<ul>
<li>å› ä¸ºæœ‰æŒ‡ä»¤é‡æ’åºçš„å­˜åœ¨ï¼Œ DCLä¸ä¸€å®šå®‰å…¨ã€‚ä½†æ˜¯åŠ äº† volatile å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è‡ªèº«å®ä¾‹åŒ–å¯¹è±¡è®¾ç½®ä¸ºä¸€ä¸ªå±æ€§ï¼Œå¹¶ç”¨staticä¿®é¥°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ç§æœ‰åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™æ€æ–¹æ³•è¿”å›è¯¥å®ä¾‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥instanceæ˜¯å¦è¢«å®ä¾‹åŒ–å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰è¿›å…¥ifå—</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">// æŸä¸ªçº¿ç¨‹å–å¾—äº†ç±»é”ï¼Œå®ä¾‹åŒ–å¯¹è±¡å‰ç¬¬äºŒæ¬¡æ£€æŸ¥instanceæ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–å‡ºæ¥</span></span><br><span class="line">                <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œæ‰æœ€ç»ˆå®ä¾‹å‡ºå¯¹è±¡</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();<span class="comment">//è¿™ä¸€è¡Œä»£ç å¯ä»¥åˆ†ä¸º ä¸‰æ­¥ã€‚æœ‰å¯èƒ½æŒ‡ä»¤é‡æ’åº</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ä¸‰-concurrenthashmap">ä¸‰ã€ConcurrentHashMap</h2>
<p><strong>if (<code>key == null || value == null</code>) throw new <code>NullPointerException();</code></strong></p>
<ul>
<li><strong>key-valueéƒ½ä¸å¯ä¸ºç©ºï¼</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Implementation for put and putIfAbsent */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br></pre></td></tr></table></figure>
<p><strong>ConcurrentHashMap å¯ä»¥æ”¯æŒå¹¶å‘çš„è¯»å†™</strong>ã€‚</p>
<img src="https://i.loli.net/2019/07/17/5d2ece546df0066415.png" alt="1.png" title="1.png">
<p><strong>HashMapï¼šéçº¿ç¨‹å®‰å…¨</strong>ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚</p>
<ul>
<li>HashMap åšput æ“ä½œçš„æ—¶å€™ï¼Œå‡å¦‚Açº¿ç¨‹å’ŒBçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªæ•°ç»„ä½ç½®è°ƒç”¨addEntryï¼Œä¸¤ä¸ªçº¿ç¨‹ä¼šåŒæ—¶å¾—åˆ°ç°åœ¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åAå†™å…¥æ–°çš„å¤´ç»“ç‚¹ä¹‹åï¼ŒBä¹Ÿå†™å…¥æ–°çš„å¤´ç»“ç‚¹ï¼Œé‚£Bçš„å†™å…¥æ“ä½œå°±ä¼šè¦†ç›–Açš„å†™å…¥æ“ä½œé€ æˆAçš„å†™å…¥æ“ä½œä¸¢å¤±ã€‚åŒç†ï¼Œå½“å¤šçº¿ç¨‹å¯¹åŒä¸€æ•°ç»„ä½ç½®è¿›è¡Œremoveæ“ä½œæ—¶ä¹Ÿä¼šäº§ç”Ÿè¦†ç›–ã€‚å› æ­¤å¦‚æœä¸è¿›è¡Œé¢å¤–çš„å¤–åŒæ­¥æ“ä½œï¼ŒHashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚æ ·å¿…ç„¶å¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”ç«äº‰è¶Šæ¿€çƒˆï¼Œæ•ˆç‡è¶Šä½ä¸‹ã€‚ä¸¥é‡æƒ…å†µï¼Œ<strong>ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨HashMapè¿›è¡Œputæ“ä½œä¼šå¼•èµ·æ­»å¾ªç¯(æ¯”å¦‚putçš„ä¸¤ä¸ªå¯¹è±¡ å¼•èµ·æ‰©å®¹ï¼Œå¯èƒ½å‡ºç°åŒæ—¶åœ¨åŒä¸€æ•°ç»„ä¸‹ç”¨é“¾è¡¨è¡¨ç¤ºï¼Œç»“æœåœ¨getæ—¶ä¼šå‡ºç°æ­»å¾ªç¯)ï¼Œå¯¼è‡´CPUåˆ©ç”¨ç‡æ¥è¿‘100%</strong>ã€‚</li>
</ul>
<p><strong>HashTableï¼šé—ç•™ç±»ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</strong> å¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥Hashtableã€‚</p>
<ul>
<li>HashTable åªæœ‰ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—® HashTable çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šå°†æ•´å¼  table é”ä½ï¼Œå½“å…¶ä»–çº¿ç¨‹ä¹Ÿæƒ³è®¿é—® HashTable åŒæ­¥æ–¹æ³•æ—¶ï¼Œå°±ä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹åŒæ­¥æ–¹æ³•çš„å ç”¨ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œç¡®ä¿çº¿ç¨‹çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ HashTable å¯¹ getï¼Œputï¼Œremove æ–¹æ³•éƒ½ä½¿ç”¨äº†åŒæ­¥æ“ä½œï¼Œè¿™å°±é€ æˆå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½åªæƒ³ä½¿ç”¨get æ–¹æ³•å»è¯»å–æ•°æ®æ—¶ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹å…ˆåˆ°è¿›è¡Œäº†é”æ“ä½œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±ä¸å¾—ä¸ç­‰å¾…ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”ç«äº‰è¶Šæ¿€çƒˆï¼Œæ•ˆç‡è¶Šä½ä¸‹ã€‚</li>
</ul>
<h3 id="31-jdk-17-concurrenthashmap">3.1ã€JDK 1.7 ConcurrentHashMap</h3>
<p><strong>ReentrantLock + Segment + HashEntry</strong></p>
<p><strong>JDK1.7 ä¹‹å‰çš„ ConcurrentHashMap <code>æ•°ç»„+é“¾è¡¨</code> ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶å®ç°ã€‚(JDK 1.5â€”JDK1.7)</strong></p>
<ul>
<li>ConcurrentHashMap åœ¨å¯¹è±¡ä¸­ä¿å­˜äº†ä¸€ä¸ª Segment æ•°ç»„ï¼Œå³å°†æ•´ä¸ªHashè¡¨åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†æ®µï¼›è€Œæ¯ä¸ªSegment å…ƒç´ ï¼Œå³æ¯ä¸ªåˆ†æ®µåˆ™ç±»ä¼¼äºä¸€ä¸ªHashtableï¼›è¿™æ ·ï¼Œåœ¨æ‰§è¡Œputæ“ä½œæ—¶é¦–å…ˆæ ¹æ®hashç®—æ³•å®šä½åˆ°å…ƒç´ å±äºå“ªä¸ª Segmentï¼Œç„¶åå¯¹è¯¥SegmentåŠ é”å³å¯ã€‚</li>
</ul>
<hr>
<h3 id="32-jdk-18-concurrenthashmap">3.2ã€JDK 1.8 ConcurrentHashMap</h3>
<p><strong>Synchronized + CAS + HashEntry + Red-Black Tree</strong></p>
<p><strong>JDK 1.8 å·²ç»æŠ›å¼ƒäº†Segment çš„æ¦‚å¿µï¼Œè™½ç„¶æºç é‡Œé¢è¿˜ä¿ç•™äº†ï¼Œä¹Ÿåªæ˜¯ä¸ºäº†å…¼å®¹æ€§çš„è€ƒè™‘ã€‚</strong><br>
<strong>JDK1.8 åˆ™ä½¿ç”¨<code>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘æ•°æ®ç»“æ„ã€å¹¶å‘æ§åˆ¶ä½¿ç”¨Synchronizedå’ŒCASåŸå­æ“ä½œ</code>å®ç°ConcurrentHashMap</strong></p>
<h4 id="concurrenthashmap-çš„putæ–¹æ³•å®ç°">ConcurrentHashMap çš„putæ–¹æ³•å®ç°</h4>
<p><strong>å®ç°æ€è·¯ï¼š</strong></p>
<ul>
<li><strong>1.å¦‚æœæ²¡æœ‰åˆå§‹åŒ–å°±å…ˆè°ƒç”¨ initTable() æ–¹æ³•æ¥è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹ã€‚</strong></li>
<li><strong>2.å¦‚æœæ²¡æœ‰hashå†²çªå°±ç›´æ¥CASæ’å…¥ã€‚</strong></li>
<li><strong>3.å¦‚æœè¿˜åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œå°±å…ˆè¿›è¡Œæ‰©å®¹ã€‚</strong></li>
<li><strong>4.å¦‚æœå­˜åœ¨hashå†²çªï¼Œå°±åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯é“¾è¡¨å½¢å¼å°±ç›´æ¥éå†åˆ°å°¾ç«¯æ’å…¥ï¼Œä¸€ç§æ˜¯çº¢é»‘æ ‘å°±æŒ‰ç…§çº¢é»‘æ ‘ç»“æ„æ’å…¥</strong>ã€‚</li>
<li><strong>5.æœ€åä¸€ä¸ªå¦‚æœè¯¥é“¾è¡¨çš„æ•°é‡å¤§äºé˜ˆå€¼8ï¼Œå°±è¦å…ˆè½¬æ¢æˆé»‘çº¢æ ‘çš„ç»“æ„ï¼Œbreakå†ä¸€æ¬¡è¿›å…¥å¾ªç¯</strong>ã€‚</li>
<li><strong>6.å¦‚æœæ·»åŠ æˆåŠŸå°±è°ƒç”¨ addCount() æ–¹æ³•ç»Ÿè®¡sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</strong>ã€‚</li>
</ul>
<hr>
<h4 id="concurrenthashmap-çš„getæ–¹æ³•å®ç°">ConcurrentHashMap çš„getæ–¹æ³•å®ç°</h4>
<p><strong>å®ç°æ€è·¯ï¼š</strong></p>
<ul>
<li><strong>1.è®¡ç®—hashå€¼ï¼Œå®šä½åˆ°è¯¥tableç´¢å¼•ä½ç½®ï¼Œå¦‚æœæ˜¯é¦–èŠ‚ç‚¹ç¬¦åˆå°±è¿”å›</strong>ã€‚</li>
<li><strong>2.å¦‚æœé‡åˆ°æ‰©å®¹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ ‡å¿—æ­£åœ¨æ‰©å®¹èŠ‚ç‚¹ForwardingNodeçš„findæ–¹æ³•ï¼ŒæŸ¥æ‰¾è¯¥èŠ‚ç‚¹ï¼ŒåŒ¹é…å°±è¿”å›</strong>ã€‚</li>
<li><strong>3.ä»¥ä¸Šéƒ½ä¸ç¬¦åˆçš„è¯ï¼Œå°±å¾€ä¸‹éå†èŠ‚ç‚¹ï¼ŒåŒ¹é…å°±è¿”å›ï¼Œå¦åˆ™æœ€åå°±è¿”å›null</strong> ã€‚</li>
</ul>
<hr>
<h3 id="33-jdk18-synchronizedä»£æ›¿reentrantlock">3.3ã€JDK1.8 Synchronizedä»£æ›¿ReentrantLock</h3>
<p><strong>JDK1.8ä¸ºä»€ä¹ˆä½¿ç”¨å†…ç½®é”synchronizedæ¥ä»£æ›¿é‡å…¥é”ReentrantLockï¼š</strong></p>
<ol>
<li>å› ä¸ºç²’åº¦é™ä½äº†ï¼Œåœ¨ç›¸å¯¹è€Œè¨€çš„ä½ç²’åº¦åŠ é”æ–¹å¼ï¼Œsynchronized å¹¶ä¸æ¯” ReentrantLock å·®ï¼Œåœ¨ç²—ç²’åº¦åŠ é”ä¸­ReentrantLock å¯èƒ½é€šè¿‡ Condition æ¥æ§åˆ¶å„ä¸ªä½ç²’åº¦çš„è¾¹ç•Œï¼Œæ›´åŠ çš„çµæ´»ï¼Œè€Œåœ¨ä½ç²’åº¦ä¸­ï¼ŒCondition çš„ä¼˜åŠ¿å°±æ²¡æœ‰äº†ï¼›</li>
<li>JVMçš„å¼€å‘å›¢é˜Ÿä»æ¥éƒ½æ²¡æœ‰æ”¾å¼ƒ synchronizedï¼Œè€Œä¸”åŸºäº JVM çš„ synchronized ä¼˜åŒ–ç©ºé—´æ›´å¤§ï¼Œä½¿ç”¨å†…åµŒçš„å…³é”®å­—æ¯”ä½¿ç”¨APIæ›´åŠ è‡ªç„¶ï¼›</li>
<li>åœ¨å¤§é‡çš„æ•°æ®æ“ä½œä¸‹ï¼Œå¯¹äºJVMçš„å†…å­˜å‹åŠ›ï¼ŒåŸºäº API çš„ ReentrantLock ä¼šå¼€é”€æ›´å¤šçš„å†…å­˜ï¼Œè™½ç„¶ä¸æ˜¯ç“¶é¢ˆï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªé€‰æ‹©ä¾æ®ã€‚</li>
</ol>
<hr>
<h2 id="copyonwritearraylistcopyonwritearrayset">CopyOnWriteArrayList/CopyOnWriteArraySet:</h2>
<p><strong>â€œå†™å…¥å¹¶å¤åˆ¶â€æ¯æ¬¡å†™å…¥å¤åˆ¶æ–°è¡¨</strong></p>
<p><strong>æ³¨æ„ï¼š</strong><br>
<strong>æ·»åŠ æ“ä½œå¤šæ—¶ï¼Œæ•ˆç‡ä½ï¼Œå› ä¸ºæ¯æ¬¡æ·»åŠ æ—¶éƒ½ä¼šè¿›è¡Œå¤åˆ¶ï¼Œå¼€é”€éå¸¸çš„å¤§ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCopyOnWriteArrayList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		HelloThread ht = <span class="keyword">new</span> HelloThread();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(ht).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="comment">//java.util.ConcurrentModificationException</span></span><br><span class="line"><span class="comment">//	private static List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;String&gt;());</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		list.add(<span class="string">"AA"</span>);</span><br><span class="line">		list.add(<span class="string">"BB"</span>);</span><br><span class="line">		list.add(<span class="string">"CC"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">			System.out.println(it.next());</span><br><span class="line"></span><br><span class="line">			list.add(<span class="string">"AA"</span>);</span><br><span class="line">			list.add(<span class="string">"A"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="countdownlatch-é—­é”">CountDownLatch é—­é”</h2>
<p><strong>CountDownLatch ï¼š</strong><br>
<strong>é—­é”ï¼Œåœ¨å®ŒæˆæŸäº›è¿ç®—æ—¶ï¼Œåªæœ‰å…¶ä»–æ‰€æœ‰çº¿ç¨‹çš„è¿ç®—å…¨éƒ¨å®Œæˆï¼Œå½“å‰è¿ç®—æ‰ç»§ç»­æ‰§è¡Œã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCountDownLatch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line">		LatchDemo ld = <span class="keyword">new</span> LatchDemo(latch);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//10ä¸ªåˆ†çº¿ç¨‹</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(ld).start();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//ä¸åŠ  latch.await();   10ä¸ªåˆ†çº¿ç¨‹å’Œ 1ä¸ªä¸»çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæ²¡åŠæ³•è®¡ç®—æ—¶é—´</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			latch.await();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">long</span> end = System.currentTimeMillis();<span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + (end - start));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LatchDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> CountDownLatch latch;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LatchDemo</span><span class="params">(CountDownLatch latch)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.latch = latch;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//æ‰“å°50000ä»¥å†…çš„å¶æ•°</span></span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">						System.out.println(i);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				latch.countDown();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="å®ç°callable-æ¥å£">å®ç°Callable æ¥å£</h2>
<p><strong>åˆ›å»ºæ‰§è¡Œçº¿ç¨‹çš„æ–¹å¼ å›› ç§</strong></p>
<p>å››ç§æ–¹å¼è§£ç­”â€“&gt;<a href="https://blog.csdn.net/m0_37840000/article/details/79756932" target="_blank" rel="noopener">è¿™ä¸ªåšå®¢è¶…è¯¦ç»†</a></p>
<p>1ï¼‰ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹</p>
<p>2ï¼‰å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹</p>
<p>3ï¼‰ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</p>
<p>4ï¼‰ä½¿ç”¨çº¿ç¨‹æ± ä¾‹å¦‚ç”¨Executoræ¡†æ¶</p>
<ul>
<li><strong>åˆ›å»ºæ‰§è¡Œçº¿ç¨‹çš„æ–¹å¼ä¸‰ï¼šå®ç° Callable æ¥å£ã€‚ ç›¸è¾ƒäºå®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œæ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸</strong></li>
<li><strong>æ‰§è¡Œ Callable æ–¹å¼ï¼Œéœ€è¦ FutureTask å®ç°ç±»çš„æ”¯æŒï¼Œç”¨äºæ¥æ”¶è¿ç®—ç»“æœã€‚  FutureTask æ˜¯  Future æ¥å£çš„å®ç°ç±»</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCallable</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ThreadDemo td = <span class="keyword">new</span> ThreadDemo();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1.æ‰§è¡Œ Callable æ–¹å¼ï¼Œéœ€è¦ FutureTask å®ç°ç±»çš„æ”¯æŒï¼Œç”¨äºæ¥æ”¶è¿ç®—ç»“æœã€‚</span></span><br><span class="line">		FutureTask&lt;Integer&gt; result = <span class="keyword">new</span> FutureTask&lt;&gt;(td);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(result).start();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.æ¥æ”¶çº¿ç¨‹è¿ç®—åçš„ç»“æœ</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Integer sum = result.get();  <span class="comment">//FutureTask å¯ç”¨äº é—­é”</span></span><br><span class="line">			System.out.println(sum);</span><br><span class="line">			System.out.println(<span class="string">"------------------------------------"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">			sum += i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sum;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®ç°Runnable å¯¹æ¯”</span></span><br><span class="line"><span class="comment">/*class ThreadDemo implements Runnable&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	@Override</span></span><br><span class="line"><span class="comment">	public void run() &#123;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="è§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜æ–¹æ³•">è§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜æ–¹æ³•</h2>
<p><strong>synchronized:éšå¼é” ï¼ˆJVMåº•å±‚å…³é”®å­—ï¼‰</strong></p>
<p><strong>ä¸¤ç§æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>åŒæ­¥ä»£ç å—</strong></li>
<li><strong>åŒæ­¥æ–¹æ³•  â€”â€”jdk 1.5 ä»¥å‰ ä¸¤ç§</strong></li>
<li><strong>jdk 1.5 å åŒæ­¥é” Lock</strong><br>
<strong>æ³¨æ„ï¼šæ˜¯ä¸€ä¸ªæ˜¾ç¤ºé”ï¼Œéœ€è¦é€šè¿‡ lock() æ–¹æ³•ä¸Šé”ï¼Œå¿…é¡»é€šè¿‡ unlock() æ–¹æ³•è¿›è¡Œé‡Šæ”¾é”</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLock</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Ticket ticket = <span class="keyword">new</span> Ticket();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(ticket, <span class="string">"1å·çª—å£"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(ticket, <span class="string">"2å·çª—å£"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(ticket, <span class="string">"3å·çª—å£"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tick = <span class="number">100</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">			</span><br><span class="line">			lock.lock(); <span class="comment">//ä¸Šé”</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(tick &gt; <span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						Thread.sleep(<span class="number">200</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">					System.out.println(Thread.currentThread().getName() + <span class="string">" å®Œæˆå”®ç¥¨ï¼Œä½™ç¥¨ä¸ºï¼š"</span> + --tick);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				lock.unlock(); <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹-åŒæ­¥é”synchronized">ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹ åŒæ­¥é”synchronized</h2>
<h3 id="å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶-è™šå‡å”¤é†’çš„é—®é¢˜">å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶ è™šå‡å”¤é†’çš„é—®é¢˜</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProductorAndConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Clerk clerk = <span class="keyword">new</span> Clerk();</span><br><span class="line"></span><br><span class="line">		Productor pro = <span class="keyword">new</span> Productor(clerk);</span><br><span class="line">		Consumer cus = <span class="keyword">new</span> Consumer(clerk);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœä¸ç”¨ç­‰å¾…å”¤é†’æœºåˆ¶ä¼šäº§ç”Ÿ ä¸¢å¤±æ•°æ®</span></span><br><span class="line">		<span class="keyword">new</span> Thread(pro, <span class="string">"ç”Ÿäº§è€… A"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(cus, <span class="string">"æ¶ˆè´¹è€… B"</span>).start();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">new</span> Thread(pro, <span class="string">"ç”Ÿäº§è€… C"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(cus, <span class="string">"æ¶ˆè´¹è€… D"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åº—å‘˜</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clerk</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> product = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿›è´§</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;<span class="comment">// å¾ªç¯æ¬¡æ•°ï¼š0</span></span><br><span class="line">		<span class="comment">//å¦‚æœç”¨if  ä¼šé€ æˆè™šå‡å”¤é†’</span></span><br><span class="line">		<span class="keyword">while</span>(product &gt;= <span class="number">1</span>) &#123;<span class="comment">// ä¸ºäº†é¿å…è™šå‡å”¤é†’é—®é¢˜ï¼Œåº”è¯¥æ€»æ˜¯ä½¿ç”¨åœ¨å¾ªç¯ä¸­</span></span><br><span class="line">			System.out.println(<span class="string">"äº§å“å·²æ»¡ï¼"</span>);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">this</span>.wait();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//ä»¥ä¸‹ä»£ç å¦‚æœæ”¾è¿›else æœ‰å¯èƒ½ æ— çº¿ç¨‹å”¤é†’</span></span><br><span class="line">		System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + ++product);</span><br><span class="line">		<span class="keyword">this</span>.notifyAll();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å–è´§</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sale</span><span class="params">()</span> </span>&#123;<span class="comment">// product = 0; å¾ªç¯æ¬¡æ•°ï¼š0</span></span><br><span class="line">		<span class="comment">//å¦‚æœç”¨if  ä¼šé€ æˆè™šå‡å”¤é†’</span></span><br><span class="line">		<span class="keyword">while</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">			System.out.println(<span class="string">"ç¼ºè´§ï¼"</span>);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">this</span>.wait();<span class="comment">// åœ¨è¿™é‡Œç­‰å¾…ï¼Œè·å¾—é”ä¹‹åï¼Œåœ¨è¿™ä¸ªåœ°æ–¹å¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//ä»¥ä¸‹ä»£ç å¦‚æœæ”¾è¿›else æœ‰å¯èƒ½ æ— çº¿ç¨‹å”¤é†’</span></span><br><span class="line">		System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + --product);</span><br><span class="line">		<span class="keyword">this</span>.notifyAll();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿäº§è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Productor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Productor</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">			<span class="comment">// äº§ç”Ÿå»¶è¿Ÿ æœ‰é—®é¢˜</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">200</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			clerk.get();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">			clerk.sale();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹-åŒæ­¥é”lock">ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹ åŒæ­¥é”Lock</h2>
<h3 id="å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶-è™šå‡å”¤é†’çš„é—®é¢˜">å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶ è™šå‡å”¤é†’çš„é—®é¢˜</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProductorAndConsumerForLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Clerk clerk = <span class="keyword">new</span> Clerk();</span><br><span class="line"></span><br><span class="line">		Productor pro = <span class="keyword">new</span> Productor(clerk);</span><br><span class="line">		Consumer con = <span class="keyword">new</span> Consumer(clerk);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">new</span> Thread(pro, <span class="string">"ç”Ÿäº§è€… A"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(con, <span class="string">"æ¶ˆè´¹è€… B"</span>).start();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">new</span> Thread(pro, <span class="string">"ç”Ÿäº§è€… C"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(con, <span class="string">"æ¶ˆè´¹è€… D"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clerk</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> product = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">	<span class="keyword">private</span> Condition condition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿›è´§</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">while</span> (product &gt;= <span class="number">1</span>) &#123; <span class="comment">// ä¸ºäº†é¿å…è™šå‡å”¤é†’ï¼Œåº”è¯¥æ€»æ˜¯ä½¿ç”¨åœ¨å¾ªç¯ä¸­ã€‚</span></span><br><span class="line">				System.out.println(<span class="string">"äº§å“å·²æ»¡ï¼"</span>);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					condition.await();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + ++product);</span><br><span class="line"></span><br><span class="line">			condition.signalAll();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">//ä¸€å®šæ”¾åœ¨finally ä¸€å®šè¦é‡Šæ”¾</span></span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å–è´§</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">while</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.println(<span class="string">"ç¼ºè´§ï¼"</span>);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					condition.await();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + --product);</span><br><span class="line"></span><br><span class="line">			condition.signalAll();</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Productor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Productor</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">200</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			clerk.get();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">			clerk.sale();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="çº¿ç¨‹é¢è¯•é¢˜">çº¿ç¨‹é¢è¯•é¢˜</h2>
<p><strong>å¼€å¯ 3 ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸‰ä¸ªçº¿ç¨‹çš„ ID åˆ†åˆ«ä¸º Aã€Bã€Cï¼Œæ¯ä¸ªçº¿ç¨‹å°†è‡ªå·±çš„ ID åœ¨å±å¹•ä¸Šæ‰“å° 10 é</strong></p>
<p><strong>è¦æ±‚è¾“å‡ºçš„ç»“æœå¿…é¡»æŒ‰é¡ºåºæ˜¾ç¤ºã€‚</strong></p>
<ul>
<li>å¦‚ï¼šABCABCABCâ€¦â€¦ ä¾æ¬¡é€’å½’</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestABCAlternate</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		AlternateDemo ad = <span class="keyword">new</span> AlternateDemo();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">					ad.loopA(i);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="string">"A"</span>).start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">					ad.loopB(i);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="string">"B"</span>).start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">					ad.loopC(i);</span><br><span class="line">					</span><br><span class="line">					System.out.println(<span class="string">"-----------------------------------"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="string">"C"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlternateDemo</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>; <span class="comment">//å½“å‰æ­£åœ¨æ‰§è¡Œçº¿ç¨‹çš„æ ‡è®°</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">	<span class="keyword">private</span> Condition condition1 = lock.newCondition();</span><br><span class="line">	<span class="keyword">private</span> Condition condition2 = lock.newCondition();</span><br><span class="line">	<span class="keyword">private</span> Condition condition3 = lock.newCondition();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalLoop : å¾ªç¯ç¬¬å‡ è½®</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopA</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//1. åˆ¤æ–­</span></span><br><span class="line">			<span class="keyword">if</span>(number != <span class="number">1</span>)&#123;</span><br><span class="line">				condition1.await();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//2. æ‰“å°</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\t"</span> + totalLoop);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//3. å”¤é†’</span></span><br><span class="line">			number = <span class="number">2</span>;</span><br><span class="line">			condition2.signal();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopB</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//1. åˆ¤æ–­</span></span><br><span class="line">			<span class="keyword">if</span>(number != <span class="number">2</span>)&#123;</span><br><span class="line">				condition2.await();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//2. æ‰“å°</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\t"</span> + totalLoop);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//3. å”¤é†’</span></span><br><span class="line">			number = <span class="number">3</span>;</span><br><span class="line">			condition3.signal();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopC</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//1. åˆ¤æ–­</span></span><br><span class="line">			<span class="keyword">if</span>(number != <span class="number">3</span>)&#123;</span><br><span class="line">				condition3.await();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//2. æ‰“å°</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\t"</span> + totalLoop);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//3. å”¤é†’</span></span><br><span class="line">			number = <span class="number">1</span>;</span><br><span class="line">			condition1.signal();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="readwritelock-è¯»å†™é”">ReadWriteLock è¯»å†™é”</h2>
<p><strong>å†™å†™/è¯»å†™ éœ€è¦â€œäº’æ–¥â€</strong><br>
<strong>è¯»è¯» ä¸éœ€è¦äº’æ–¥</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReadWriteLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ReadWriteLockDemo rw = <span class="keyword">new</span> ReadWriteLockDemo();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">final</span> <span class="keyword">int</span> num = rw.set((<span class="keyword">int</span>) (Math.random() * <span class="number">101</span>));</span><br><span class="line">				System.out.println(<span class="string">"-&gt;"</span>+num);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,<span class="string">"Write"</span>).start();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">					rw.get();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> ReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¯»</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		lock.readLock().lock(); <span class="comment">// ä¸Šé”</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + number);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.readLock().unlock(); <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å†™</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">		lock.writeLock().lock();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName());</span><br><span class="line">			<span class="keyword">this</span>.number = number;</span><br><span class="line">			<span class="keyword">return</span> number;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			lock.writeLock().unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="thread8monitor-çº¿ç¨‹å…«é”">Thread8Monitor çº¿ç¨‹å…«é”</h2>
<p><strong>é¢˜ç›®ï¼šåˆ¤æ–­æ‰“å°çš„ â€œoneâ€ or â€œtwoâ€ ?</strong></p>
<ol>
<li>ä¸¤ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼Œæ ‡å‡†æ‰“å°ï¼Œ æ‰“å°? //one  two</li>
<li>æ–°å¢ Thread.sleep() ç»™ getOne() ,æ‰“å°? //one  two</li>
<li>æ–°å¢æ™®é€šæ–¹æ³• getThree() , æ‰“å°? //three  one   two  getOne()ä¸æ˜¯é™æ€</li>
<li>ä¸¤ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ª Number å¯¹è±¡ï¼Œæ‰“å°?  //two  one</li>
<li>ä¿®æ”¹ getOne() ä¸ºé™æ€åŒæ­¥æ–¹æ³•ï¼Œæ‰“å°?  //two   one</li>
<li>ä¿®æ”¹ä¸¤ä¸ªæ–¹æ³•å‡ä¸ºé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ª Number å¯¹è±¡?  //one   two</li>
<li>ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªéé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ª Number å¯¹è±¡?  //two  one</li>
<li>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ª Number å¯¹è±¡?   //one  two</li>
</ol>
<p><strong>çº¿ç¨‹å…«é”çš„å…³é”®ï¼š</strong><br>
â‘ éé™æ€æ–¹æ³•çš„é”é»˜è®¤ä¸º  this,  é™æ€æ–¹æ³•çš„é”ä¸º å¯¹åº”çš„ Class å®ä¾‹<br>
â‘¡æŸä¸€ä¸ªæ—¶åˆ»å†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œæ— è®ºå‡ ä¸ªæ–¹æ³•ã€‚</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread8Monitor</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Number number = <span class="keyword">new</span> Number();</span><br><span class="line">		Number number2 = <span class="keyword">new</span> Number(); <span class="comment">// 4é”</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				number.getOne();</span><br><span class="line">			&#125; </span><br><span class="line">		&#125;).start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//				number.getTwo(); //1ã€æ™®é€šåŒæ­¥æ–¹æ³•   2ã€åŠ sleep  3ã€æ–°å¢æ–¹æ³• getThree() --&gt;  æ–¹æ³•getOne å‡æ— é™æ€ static   </span></span><br><span class="line">				<span class="comment">//5ã€ getOne()åŠ é™æ€</span></span><br><span class="line">				</span><br><span class="line">				number2.getTwo(); <span class="comment">//4é”</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/*new Thread(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">			@Override</span></span><br><span class="line"><span class="comment">			public void run() &#123;</span></span><br><span class="line"><span class="comment">				number.getThree();</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">		&#125;).start();*/</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Number</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getOne</span><span class="params">()</span></span>&#123;<span class="comment">//é™æ€æ–¹æ³•çš„é”ä¸º  Number.class</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"one"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="comment">/*static*/</span> <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getTwo</span><span class="params">()</span></span>&#123;<span class="comment">//éé™æ€æ–¹æ³•çš„é”ä¸ºthis</span></span><br><span class="line">		System.out.println(<span class="string">"two"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getThree</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"three"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="threadpool-çº¿ç¨‹æ± ">ThreadPool çº¿ç¨‹æ± </h2>
<p><strong>çº¿ç¨‹æ± ï¼šæä¾›äº†ä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­ä¿å­˜ç€æ‰€æœ‰ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚é¿å…äº†åˆ›å»ºä¸é”€æ¯é¢å¤–å¼€é”€ï¼Œæé«˜äº†å“åº”çš„é€Ÿåº¦ã€‚</strong></p>
<p><strong>çº¿ç¨‹æ± çš„ä½“ç³»ç»“æ„ï¼š</strong></p>
<ul>
<li>java.util.concurrent.Executor : è´Ÿè´£çº¿ç¨‹çš„ä½¿ç”¨ä¸è°ƒåº¦çš„æ ¹æ¥å£
<ul>
<li><strong>ExecutorService</strong> å­æ¥å£: çº¿ç¨‹æ± çš„ä¸»è¦æ¥å£
<ul>
<li>ThreadPoolExecutor çº¿ç¨‹æ± çš„å®ç°ç±»</li>
<li>ScheduledExecutorService å­æ¥å£ï¼šè´Ÿè´£çº¿ç¨‹çš„è°ƒåº¦
<ul>
<li>ScheduledThreadPoolExecutor ï¼šç»§æ‰¿ ThreadPoolExecutor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>å·¥å…·ç±» : Executors</strong></p>
<ul>
<li>
<p>ExecutorService newFixedThreadPool() : åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </p>
</li>
<li>
<p>ExecutorService newCachedThreadPool() : ç¼“å­˜çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„æ•°é‡ä¸å›ºå®šï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªåŠ¨çš„æ›´æ”¹æ•°é‡ã€‚</p>
</li>
<li>
<p>ExecutorService newSingleThreadExecutor() : åˆ›å»ºå•ä¸ªçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹</p>
</li>
<li>
<p>ScheduledExecutorService newScheduledThreadPool() : åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹ï¼Œå¯ä»¥å»¶è¿Ÿæˆ–å®šæ—¶çš„æ‰§è¡Œä»»åŠ¡ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadPool</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//1. åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">		ExecutorService pool = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">		</span><br><span class="line">		List&lt;Future&lt;Integer&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			Future&lt;Integer&gt; future = pool.submit(<span class="keyword">new</span> Callable&lt;Integer&gt;()&#123;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">					<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">					</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">						sum += i;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span> sum;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			list.add(future);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		pool.shutdown();<span class="comment">//ä¸€å®šè¦å…³é—­</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (Future&lt;Integer&gt; future : list) &#123;</span><br><span class="line">			System.out.println(future.get());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*ThreadPoolDemo tpd = new ThreadPoolDemo();</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		//2. ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ†é…ä»»åŠ¡</span></span><br><span class="line"><span class="comment">		for (int i = 0; i &lt; 5; i++) &#123;</span></span><br><span class="line"><span class="comment">			pool.submit(tpd);</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		//3. å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">		pool.shutdown();*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//	new Thread(tpd).start(); //é¢‘ç¹åˆ›å»ºé”€æ¯ è€—è´¹èµ„æº</span></span><br><span class="line"><span class="comment">//	new Thread(tpd).start();</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(i &lt;= <span class="number">1000</span>)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + i++);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="scheduledthreadpool-çº¿ç¨‹æ± è°ƒåº¦">ScheduledThreadPool çº¿ç¨‹æ± è°ƒåº¦</h2>
<ul>
<li><strong>ScheduledExecutorService newScheduledThreadPool() : åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹ï¼Œå¯ä»¥å»¶è¿Ÿæˆ–å®šæ—¶çš„æ‰§è¡Œä»»åŠ¡ã€‚</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestScheduledThreadPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ScheduledExecutorService pool = Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">			Future&lt;Integer&gt; result = pool.schedule(<span class="keyword">new</span> Callable&lt;Integer&gt;()&#123;</span><br><span class="line"></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">					<span class="keyword">int</span> num = <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>);<span class="comment">//ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">					System.out.println(Thread.currentThread().getName() + <span class="string">" : "</span> + num);</span><br><span class="line">					<span class="keyword">return</span> num;</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;, <span class="number">1</span>, TimeUnit.SECONDS);<span class="comment">//ç§’</span></span><br><span class="line">			</span><br><span class="line">			System.out.println(result.get());</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		pool.shutdown();<span class="comment">//ä¸€å®šè¦å…³é—­</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1551442650328&di=78dfb03450cc5fff5d31ea92de81ba1f&imgtype=0&src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20160719%2F6ea36d17d5e94124ad1791eadd923554_th.jpg" width="150">
<h2 id="forkjoinpool-åˆ†æ”¯åˆå¹¶æ¡†æ¶-gtå·¥ä½œçªƒå–-jdk17">ForkJoinPool åˆ†æ”¯/åˆå¹¶æ¡†æ¶ â€”&gt;å·¥ä½œçªƒå– JDK1.7</h2>
<img src="http://ww1.sinaimg.cn/mw690/006vWPzFly1g0oawjr78lj311u0nral9.jpg">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinTask;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveTask;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.LongStream;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestForkJoinPool</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Instant start = Instant.now();</span><br><span class="line">		</span><br><span class="line">		ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();<span class="comment">//éœ€è¦Poolçš„æ”¯æŒ</span></span><br><span class="line">		</span><br><span class="line">		ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> ForkJoinSumCalculate(<span class="number">0L</span>, <span class="number">50000000000L</span>);</span><br><span class="line">		</span><br><span class="line">		Long sum = pool.invoke(task);</span><br><span class="line">		</span><br><span class="line">		System.out.println(sum);</span><br><span class="line">		</span><br><span class="line">		Instant end = Instant.now();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//166-1996-10590</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Instant start = Instant.now();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0L</span>; i &lt;= <span class="number">50000000000L</span>; i++) &#123;</span><br><span class="line">			sum += i;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(sum);</span><br><span class="line">		</span><br><span class="line">		Instant end = Instant.now();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//35-3142-15704</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//java8 æ–°ç‰¹æ€§</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Instant start = Instant.now();</span><br><span class="line">		</span><br><span class="line">		Long sum = LongStream.rangeClosed(<span class="number">0L</span>, <span class="number">50000000000L</span>)</span><br><span class="line">							 .parallel()</span><br><span class="line">							 .reduce(<span class="number">0L</span>, Long::sum);</span><br><span class="line">		</span><br><span class="line">		System.out.println(sum);</span><br><span class="line">		</span><br><span class="line">		Instant end = Instant.now();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//1536-8118</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkJoinSumCalculate</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">259195479995561737L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> start;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> end;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> THURSHOLD = <span class="number">10000L</span>;  <span class="comment">//ä¸´ç•Œå€¼</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ForkJoinSumCalculate</span><span class="params">(<span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.start = start;</span><br><span class="line">		<span class="keyword">this</span>.end = end;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Long <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> length = end - start;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(length &lt;= THURSHOLD)&#123;</span><br><span class="line">			<span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">long</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">				sum += i;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> sum;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">long</span> middle = (start + end) / <span class="number">2</span>;</span><br><span class="line">			</span><br><span class="line">			ForkJoinSumCalculate left = <span class="keyword">new</span> ForkJoinSumCalculate(start, middle); </span><br><span class="line">			left.fork(); <span class="comment">//è¿›è¡Œæ‹†åˆ†ï¼ŒåŒæ—¶å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line">			</span><br><span class="line">			ForkJoinSumCalculate right = <span class="keyword">new</span> ForkJoinSumCalculate(middle+<span class="number">1</span>, end);</span><br><span class="line">			right.fork(); <span class="comment">//</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> left.join() + right.join();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="æ„Ÿè°¢é˜…è¯»">æ„Ÿè°¢é˜…è¯»</h1>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/é¢è¯•é—®é¢˜/" data-toggle="tooltip" data-placement="top" title="é¢è¯•é—®é¢˜æ€»ç»“">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/SpringBootæ ¸å¿ƒæŠ€æœ¯/" data-toggle="tooltip" data-placement="top" title="SpringBoot æ ¸å¿ƒæŠ€æœ¯">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--æ‰“èµ-->
                
                    <div class="reward">
                        <div class="reward-button">èµ <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="http://ww1.sinaimg.cn/large/006vWPzFly1g0o77ru34uj30dz0drdhv.jpg"><b>æ”¯ä»˜å®æ‰“èµ</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="http://ww1.sinaimg.cn/large/006vWPzFly1g0o740lhb9j30rb0ov77z.jpg"><b>å¾®ä¿¡æ‰“èµ</b> </span>
                            </span></div>
                        <p class="reward-notice">èµèµä¸€ä¸‹</p>
                    </div>
                
                <!--æ‰“èµ-->

                <br>
                <!--åˆ†äº«-->
                
                <!--åˆ†äº«-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- å¤šè¯´ Share end-->

                <!-- å¤šè¯´è¯„è®ºæ¡† start -->
                
                <!-- å¤šè¯´è¯„è®ºæ¡† end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ä¸€-è¿›ç¨‹å’Œçº¿ç¨‹"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">&#x4E00;&#x3001;&#x8FDB;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#11-å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹åŒºåˆ«"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">1.1&#x3001;&#x591A;&#x8FDB;&#x7A0B;&#x4E0E;&#x591A;&#x7EBF;&#x7A0B;&#x533A;&#x522B;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#12-å®ˆæŠ¤çº¿ç¨‹ä¸éå®ˆæŠ¤çº¿ç¨‹"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">1.2&#x3001;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;&#x4E0E;&#x975E;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#å®ˆæŠ¤çº¿ç¨‹"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#éå®ˆæŠ¤çº¿ç¨‹ç”¨æˆ·çº¿ç¨‹"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">&#x975E;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;(&#x7528;&#x6237;&#x7EBF;&#x7A0B;)</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">&#x521B;&#x5EFA;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B; &#x1F447;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#åˆ›å»ºéå®ˆæŠ¤çº¿ç¨‹"><span class="toc-nav-number">1.2.4.</span> <span class="toc-nav-text">&#x521B;&#x5EFA;&#x975E;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;&#xFF1A;&#x1F447;</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#äºŒ-volatile"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">&#x4E8C;&#x3001;volatile</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#21-æµ‹è¯•-volatile-å†…å­˜å¯è§æ€§"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">2.1&#x3001;&#x6D4B;&#x8BD5; volatile &#x5185;&#x5B58;&#x53EF;&#x89C1;&#x6027;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#22-æµ‹è¯•-volatile-åŸå­æ€§"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">2.2&#x3001;&#x6D4B;&#x8BD5; volatile &#x539F;&#x5B50;&#x6027;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#23-cas"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">2.3&#x3001;CAS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#unsafe-ç±»"><span class="toc-nav-number">2.3.1.</span> <span class="toc-nav-text">Unsafe &#x7C7B;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#cas-çš„ç¼ºç‚¹"><span class="toc-nav-number">2.3.2.</span> <span class="toc-nav-text">CAS &#x7684;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#aba-é—®é¢˜"><span class="toc-nav-number">2.3.3.</span> <span class="toc-nav-text">ABA &#x95EE;&#x9898; &#x1F447;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#è§£å†³-aba-åŸå­å¼•ç”¨"><span class="toc-nav-number">2.3.4.</span> <span class="toc-nav-text">&#x89E3;&#x51B3; ABA &#x539F;&#x5B50;&#x5F15;&#x7528;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#æ¨¡æ‹Ÿ-cas-ç®—æ³•"><span class="toc-nav-number">2.3.5.</span> <span class="toc-nav-text">&#x6A21;&#x62DF; CAS &#x7B97;&#x6CD5;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#ä¸ºä»€ä¹ˆç”¨-cas-ä¸ç”¨-synchronized"><span class="toc-nav-number">2.3.6.</span> <span class="toc-nav-text">&#x4E3A;&#x4EC0;&#x4E48;&#x7528; CAS &#x4E0D;&#x7528; Synchronized</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#24-ç¦æ­¢æŒ‡ä»¤é‡æ’"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">2.4&#x3001;&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#25-volatile-ä½¿ç”¨åœºæ™¯"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">2.5&#x3001;volatile &#x4F7F;&#x7528;&#x573A;&#x666F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#å•ä¾‹è®¾è®¡æ¨¡å¼-dclåŒæ£€æŸ¥é”æœºåˆ¶"><span class="toc-nav-number">2.5.1.</span> <span class="toc-nav-text">&#x5355;&#x4F8B;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F; DCL&#x53CC;&#x68C0;&#x67E5;&#x9501;&#x673A;&#x5236;</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ä¸‰-concurrenthashmap"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">&#x4E09;&#x3001;ConcurrentHashMap</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#31-jdk-17-concurrenthashmap"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">3.1&#x3001;JDK 1.7 ConcurrentHashMap</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#32-jdk-18-concurrenthashmap"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">3.2&#x3001;JDK 1.8 ConcurrentHashMap</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#concurrenthashmap-çš„putæ–¹æ³•å®ç°"><span class="toc-nav-number">3.2.1.</span> <span class="toc-nav-text">ConcurrentHashMap &#x7684;put&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#concurrenthashmap-çš„getæ–¹æ³•å®ç°"><span class="toc-nav-number">3.2.2.</span> <span class="toc-nav-text">ConcurrentHashMap &#x7684;get&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#33-jdk18-synchronizedä»£æ›¿reentrantlock"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">3.3&#x3001;JDK1.8 Synchronized&#x4EE3;&#x66FF;ReentrantLock</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#copyonwritearraylistcopyonwritearrayset"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">CopyOnWriteArrayList/CopyOnWriteArraySet:</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#countdownlatch-é—­é”"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">CountDownLatch &#x95ED;&#x9501;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#å®ç°callable-æ¥å£"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">&#x5B9E;&#x73B0;Callable &#x63A5;&#x53E3;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#è§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜æ–¹æ³•"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">&#x89E3;&#x51B3;&#x591A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x65B9;&#x6CD5;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹-åŒæ­¥é”synchronized"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x6848;&#x4F8B; &#x540C;&#x6B65;&#x9501;synchronized</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶-è™šå‡å”¤é†’çš„é—®é¢˜"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">&#x5B8C;&#x6210;&#x7B49;&#x5F85;&#x5524;&#x9192;&#x673A;&#x5236; &#x865A;&#x5047;&#x5524;&#x9192;&#x7684;&#x95EE;&#x9898;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¡ˆä¾‹-åŒæ­¥é”lock"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x6848;&#x4F8B; &#x540C;&#x6B65;&#x9501;Lock</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å®Œæˆç­‰å¾…å”¤é†’æœºåˆ¶-è™šå‡å”¤é†’çš„é—®é¢˜"><span class="toc-nav-number">9.1.</span> <span class="toc-nav-text">&#x5B8C;&#x6210;&#x7B49;&#x5F85;&#x5524;&#x9192;&#x673A;&#x5236; &#x865A;&#x5047;&#x5524;&#x9192;&#x7684;&#x95EE;&#x9898;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#çº¿ç¨‹é¢è¯•é¢˜"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">&#x7EBF;&#x7A0B;&#x9762;&#x8BD5;&#x9898;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#readwritelock-è¯»å†™é”"><span class="toc-nav-number">11.</span> <span class="toc-nav-text">ReadWriteLock &#x8BFB;&#x5199;&#x9501;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#thread8monitor-çº¿ç¨‹å…«é”"><span class="toc-nav-number">12.</span> <span class="toc-nav-text">Thread8Monitor &#x7EBF;&#x7A0B;&#x516B;&#x9501;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#threadpool-çº¿ç¨‹æ± "><span class="toc-nav-number">13.</span> <span class="toc-nav-text">ThreadPool &#x7EBF;&#x7A0B;&#x6C60;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#scheduledthreadpool-çº¿ç¨‹æ± è°ƒåº¦"><span class="toc-nav-number">14.</span> <span class="toc-nav-text">ScheduledThreadPool &#x7EBF;&#x7A0B;&#x6C60;&#x8C03;&#x5EA6;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#forkjoinpool-åˆ†æ”¯åˆå¹¶æ¡†æ¶-gtå·¥ä½œçªƒå–-jdk17"><span class="toc-nav-number">15.</span> <span class="toc-nav-text">ForkJoinPool &#x5206;&#x652F;/&#x5408;&#x5E76;&#x6846;&#x67B6; &#x2014;&gt;&#x5DE5;&#x4F5C;&#x7A83;&#x53D6; JDK1.7</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#æ„Ÿè°¢é˜…è¯»"><span class="toc-nav-number"></span> <span class="toc-nav-text">&#x611F;&#x8C22;&#x9605;&#x8BFB;</span></a>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#çº¿ç¨‹" title="çº¿ç¨‹">çº¿ç¨‹</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://yexua.github.io/" target="_blank">å¤§ä½¬</a></li>
                    
                        <li><a href="https://snailclimb.gitee.io/javaguide/#/" target="_blank">JavaGuide</a></li>
                    
                        <li><a href="http://cyc2018.gitee.io/cs-notes/#/notes/%E5%89%91%E6%8C%87%20Offer%20%E9%A2%98%E8%A7%A3%20-%20%E7%9B%AE%E5%BD%951" target="_blank">å‰‘æŒ‡Offer</a></li>
                    
                        <li><a href="http://cyc2018.gitee.io/cs-notes/#/" target="_blank">æŠ€æœ¯é¢è¯•å¿…å¤‡åŸºç¡€çŸ¥è¯†</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'â„¬'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/GitHub-yuteng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; äºè…¾ 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">èƒ¡ä¼Ÿç…Œ</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://github-yuteng.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://github-yuteng.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
